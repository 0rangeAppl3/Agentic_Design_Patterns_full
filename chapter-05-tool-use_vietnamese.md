Ch∆∞∆°ng 5: S·ª≠ d·ª•ng C√¥ng c·ª• (G·ªçi h√†m)

T·ªïng quan v·ªÅ M·∫´u h√¨nh S·ª≠ d·ª•ng C√¥ng c·ª•

Cho ƒë·∫øn nay, ch√∫ng ta ƒë√£ th·∫£o lu·∫≠n v·ªÅ c√°c m·∫´u h√¨nh agent (t√°c t·ª≠) ch·ªß y·∫øu li√™n quan ƒë·∫øn vi·ªác ƒëi·ªÅu ph·ªëi c√°c t∆∞∆°ng t√°c gi·ªØa c√°c m√¥ h√¨nh ng√¥n ng·ªØ v√† qu·∫£n l√Ω lu·ªìng th√¥ng tin trong quy tr√¨nh l√†m vi·ªác n·ªôi b·ªô c·ªßa agent (N·ªëi chu·ªói, ƒê·ªãnh tuy·∫øn, Song song h√≥a, Ph·∫£n t∆∞). Tuy nhi√™n, ƒë·ªÉ c√°c agent th·ª±c s·ª± h·ªØu √≠ch v√† t∆∞∆°ng t√°c v·ªõi th·∫ø gi·ªõi th·ª±c ho·∫∑c c√°c h·ªá th·ªëng b√™n ngo√†i, ch√∫ng c·∫ßn kh·∫£ nƒÉng s·ª≠ d·ª•ng C√¥ng c·ª•.

M·∫´u h√¨nh S·ª≠ d·ª•ng C√¥ng c·ª•, th∆∞·ªùng ƒë∆∞·ª£c tri·ªÉn khai th√¥ng qua m·ªôt c∆° ch·∫ø g·ªçi l√† G·ªçi h√†m (Function Calling), cho ph√©p agent t∆∞∆°ng t√°c v·ªõi c√°c API, c∆° s·ªü d·ªØ li·ªáu, d·ªãch v·ª• b√™n ngo√†i ho·∫∑c th·∫≠m ch√≠ th·ª±c thi m√£. N√≥ cho ph√©p LLM l√†m l√µi c·ªßa agent quy·∫øt ƒë·ªãnh khi n√†o v√† l√†m th·∫ø n√†o ƒë·ªÉ s·ª≠ d·ª•ng m·ªôt h√†m b√™n ngo√†i c·ª• th·ªÉ d·ª±a tr√™n y√™u c·∫ßu c·ªßa ng∆∞·ªùi d√πng ho·∫∑c tr·∫°ng th√°i hi·ªán t·∫°i c·ªßa t√°c v·ª•.

Qu√° tr√¨nh n√†y th∆∞·ªùng bao g·ªìm:

ƒê·ªãnh nghƒ©a C√¥ng c·ª•:

C√°c h√†m ho·∫∑c kh·∫£ nƒÉng b√™n ngo√†i ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a v√† m√¥ t·∫£ cho LLM. M√¥ t·∫£ n√†y bao g·ªìm m·ª•c ƒë√≠ch, t√™n c·ªßa h√†m v√† c√°c tham s·ªë m√† n√≥ ch·∫•p nh·∫≠n, c√πng v·ªõi ki·ªÉu d·ªØ li·ªáu v√† m√¥ t·∫£ c·ªßa ch√∫ng.

Quy·∫øt ƒë·ªãnh c·ªßa LLM:

LLM nh·∫≠n y√™u c·∫ßu c·ªßa ng∆∞·ªùi d√πng v√† c√°c ƒë·ªãnh nghƒ©a c√¥ng c·ª• c√≥ s·∫µn. D·ª±a tr√™n s·ª± hi·ªÉu bi·∫øt v·ªÅ y√™u c·∫ßu v√† c√°c c√¥ng c·ª•, LLM quy·∫øt ƒë·ªãnh xem vi·ªác g·ªçi m·ªôt ho·∫∑c nhi·ªÅu c√¥ng c·ª• c√≥ c·∫ßn thi·∫øt ƒë·ªÉ ho√†n th√†nh y√™u c·∫ßu hay kh√¥ng.

T·∫°o l·ªánh G·ªçi h√†m:

N·∫øu LLM quy·∫øt ƒë·ªãnh s·ª≠ d·ª•ng m·ªôt c√¥ng c·ª•, n√≥ s·∫Ω t·∫°o ra m·ªôt ƒë·∫ßu ra c√≥ c·∫•u tr√∫c (th∆∞·ªùng l√† m·ªôt ƒë·ªëi t∆∞·ª£ng JSON) ch·ªâ ƒë·ªãnh t√™n c·ªßa c√¥ng c·ª• c·∫ßn g·ªçi v√† c√°c ƒë·ªëi s·ªë (tham s·ªë) ƒë·ªÉ truy·ªÅn cho n√≥, ƒë∆∞·ª£c tr√≠ch xu·∫•t t·ª´ y√™u c·∫ßu c·ªßa ng∆∞·ªùi d√πng.

Th·ª±c thi C√¥ng c·ª•:

Framework c·ªßa agent ho·∫∑c l·ªõp ƒëi·ªÅu ph·ªëi s·∫Ω ch·∫∑n ƒë·∫ßu ra c√≥ c·∫•u tr√∫c n√†y. N√≥ x√°c ƒë·ªãnh c√¥ng c·ª• ƒë∆∞·ª£c y√™u c·∫ßu v√† th·ª±c thi h√†m b√™n ngo√†i th·ª±c t·∫ø v·ªõi c√°c ƒë·ªëi s·ªë ƒë∆∞·ª£c cung c·∫•p.

Quan s√°t/K·∫øt qu·∫£:

ƒê·∫ßu ra ho·∫∑c k·∫øt qu·∫£ t·ª´ vi·ªác th·ª±c thi c√¥ng c·ª• ƒë∆∞·ª£c tr·∫£ v·ªÅ cho agent.

X·ª≠ l√Ω c·ªßa LLM (T√πy ch·ªçn nh∆∞ng ph·ªï bi·∫øn):

LLM nh·∫≠n ƒë·∫ßu ra c·ªßa c√¥ng c·ª• l√†m ng·ªØ c·∫£nh v√† s·ª≠ d·ª•ng n√≥ ƒë·ªÉ ƒë∆∞a ra ph·∫£n h·ªìi cu·ªëi c√πng cho ng∆∞·ªùi d√πng ho·∫∑c quy·∫øt ƒë·ªãnh b∆∞·ªõc ti·∫øp theo trong quy tr√¨nh l√†m vi·ªác (c√≥ th·ªÉ li√™n quan ƒë·∫øn vi·ªác g·ªçi m·ªôt c√¥ng c·ª• kh√°c, ph·∫£n t∆∞ ho·∫∑c cung c·∫•p c√¢u tr·∫£ l·ªùi cu·ªëi c√πng).

M·∫´u h√¨nh n√†y l√† n·ªÅn t·∫£ng v√¨ n√≥ ph√° v·ª° nh·ªØng h·∫°n ch·∫ø c·ªßa d·ªØ li·ªáu hu·∫•n luy·ªán c·ªßa LLM v√† cho ph√©p n√≥ truy c·∫≠p th√¥ng tin c·∫≠p nh·∫≠t, th·ª±c hi·ªán c√°c ph√©p t√≠nh m√† n√≥ kh√¥ng th·ªÉ t·ª± l√†m, t∆∞∆°ng t√°c v·ªõi d·ªØ li·ªáu c·ª• th·ªÉ c·ªßa ng∆∞·ªùi d√πng ho·∫∑c k√≠ch ho·∫°t c√°c h√†nh ƒë·ªông trong th·∫ø gi·ªõi th·ª±c. G·ªçi h√†m l√† c∆° ch·∫ø k·ªπ thu·∫≠t b·∫Øc c·∫ßu gi·ªØa kh·∫£ nƒÉng suy lu·∫≠n c·ªßa LLM v√† v√¥ s·ªë c√°c ch·ª©c nƒÉng b√™n ngo√†i c√≥ s·∫µn.

M·∫∑c d√π "g·ªçi h√†m" (function calling) m√¥ t·∫£ ch√≠nh x√°c vi·ªác g·ªçi c√°c h√†m m√£ c·ª• th·ªÉ, ƒë∆∞·ª£c x√°c ƒë·ªãnh tr∆∞·ªõc, nh∆∞ng s·∫Ω h·ªØu √≠ch h∆°n khi xem x√©t kh√°i ni·ªám m·ªü r·ªông h∆°n v·ªÅ "g·ªçi c√¥ng c·ª•" (tool calling). Thu·∫≠t ng·ªØ r·ªông h∆°n n√†y th·ª´a nh·∫≠n r·∫±ng c√°c kh·∫£ nƒÉng c·ªßa m·ªôt agent c√≥ th·ªÉ v∆∞·ª£t xa vi·ªác th·ª±c thi h√†m ƒë∆°n gi·∫£n. M·ªôt "c√¥ng c·ª•" c√≥ th·ªÉ l√† m·ªôt h√†m truy·ªÅn th·ªëng, nh∆∞ng n√≥ c≈©ng c√≥ th·ªÉ l√† m·ªôt ƒëi·ªÉm cu·ªëi API (API endpoint) ph·ª©c t·∫°p, m·ªôt y√™u c·∫ßu ƒë·∫øn c∆° s·ªü d·ªØ li·ªáu, ho·∫∑c th·∫≠m ch√≠ l√† m·ªôt ch·ªâ th·ªã h∆∞·ªõng ƒë·∫øn m·ªôt agent chuy√™n bi·ªát kh√°c. G√≥c nh√¨n n√†y cho ph√©p ch√∫ng ta h√¨nh dung c√°c h·ªá th·ªëng ph·ª©c t·∫°p h∆°n, n∆°i m√†, v√≠ d·ª•, m·ªôt agent ch√≠nh c√≥ th·ªÉ ·ªßy th√°c m·ªôt t√°c v·ª• ph√¢n t√≠ch d·ªØ li·ªáu ph·ª©c t·∫°p cho m·ªôt "agent ph√¢n t√≠ch" chuy√™n d·ª•ng ho·∫∑c truy v·∫•n m·ªôt c∆° s·ªü tri th·ª©c b√™n ngo√†i th√¥ng qua API c·ªßa n√≥. T∆∞ duy theo h∆∞·ªõng "g·ªçi c√¥ng c·ª•" n·∫Øm b·∫Øt t·ªët h∆°n ti·ªÅm nƒÉng ƒë·∫ßy ƒë·ªß c·ªßa c√°c agent trong vai tr√≤ l√† ng∆∞·ªùi ƒëi·ªÅu ph·ªëi xuy√™n su·ªët m·ªôt h·ªá sinh th√°i ƒëa d·∫°ng g·ªìm c√°c t√†i nguy√™n k·ªπ thu·∫≠t s·ªë v√† c√°c th·ª±c th·ªÉ th√¥ng minh kh√°c.

C√°c framework nh∆∞ LangChain, LangGraph, v√† Google Agent Developer Kit (ADK) cung c·∫•p h·ªó tr·ª£ m·∫°nh m·∫Ω ƒë·ªÉ ƒë·ªãnh nghƒ©a c√°c c√¥ng c·ª• v√† t√≠ch h·ª£p ch√∫ng v√†o quy tr√¨nh l√†m vi·ªác c·ªßa agent, th∆∞·ªùng t·∫≠n d·ª•ng kh·∫£ nƒÉng g·ªçi h√†m g·ªëc c·ªßa c√°c LLM hi·ªán ƒë·∫°i nh∆∞ trong chu·ªói Gemini ho·∫∑c OpenAI. Tr√™n "khung s∆∞·ªùn" (canvas) c·ªßa c√°c framework n√†y, b·∫°n ƒë·ªãnh nghƒ©a c√°c c√¥ng c·ª• v√† sau ƒë√≥ c·∫•u h√¨nh c√°c agent (th∆∞·ªùng l√† LLM Agents) ƒë·ªÉ nh·∫≠n bi·∫øt v√† c√≥ kh·∫£ nƒÉng s·ª≠ d·ª•ng c√°c c√¥ng c·ª• n√†y.

S·ª≠ d·ª•ng C√¥ng c·ª• l√† m·ªôt m·∫´u h√¨nh n·ªÅn t·∫£ng ƒë·ªÉ x√¢y d·ª±ng c√°c agent m·∫°nh m·∫Ω, c√≥ t√≠nh t∆∞∆°ng t√°c v√† nh·∫≠n bi·∫øt ƒë∆∞·ª£c m√¥i tr∆∞·ªùng b√™n ngo√†i.

·ª®ng d·ª•ng Th·ª±c t·∫ø & Tr∆∞·ªùng h·ª£p S·ª≠ d·ª•ng

M·∫´u h√¨nh S·ª≠ d·ª•ng C√¥ng c·ª• c√≥ th·ªÉ √°p d·ª•ng trong h·∫ßu h·∫øt m·ªçi t√¨nh hu·ªëng m√† agent c·∫ßn v∆∞·ª£t ra ngo√†i vi·ªác t·∫°o vƒÉn b·∫£n ƒë·ªÉ th·ª±c hi·ªán m·ªôt h√†nh ƒë·ªông ho·∫∑c truy xu·∫•t th√¥ng tin ƒë·ªông, c·ª• th·ªÉ:

1. Truy xu·∫•t th√¥ng tin t·ª´ c√°c ngu·ªìn b√™n ngo√†i: Truy c·∫≠p d·ªØ li·ªáu ho·∫∑c th√¥ng tin th·ªùi gian th·ª±c kh√¥ng c√≥ trong d·ªØ li·ªáu hu·∫•n luy·ªán c·ªßa LLM.

Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng:

M·ªôt agent th·ªùi ti·∫øt.

C√¥ng c·ª•:

M·ªôt API th·ªùi ti·∫øt nh·∫≠n ƒë·∫ßu v√†o l√† m·ªôt v·ªã tr√≠ v√† tr·∫£ v·ªÅ ƒëi·ªÅu ki·ªán th·ªùi ti·∫øt hi·ªán t·∫°i.

Lu·ªìng c·ªßa Agent:

Ng∆∞·ªùi d√πng h·ªèi, "Th·ªùi ti·∫øt ·ªü London th·∫ø n√†o?", LLM x√°c ƒë·ªãnh c·∫ßn c√¥ng c·ª• th·ªùi ti·∫øt, g·ªçi c√¥ng c·ª• v·ªõi "London", c√¥ng c·ª• tr·∫£ v·ªÅ d·ªØ li·ªáu, LLM ƒë·ªãnh d·∫°ng d·ªØ li·ªáu th√†nh ph·∫£n h·ªìi th√¢n thi·ªán v·ªõi ng∆∞·ªùi d√πng.

2. T∆∞∆°ng t√°c v·ªõi C∆° s·ªü d·ªØ li·ªáu v√† API: Th·ª±c hi·ªán c√°c truy v·∫•n, c·∫≠p nh·∫≠t ho·∫∑c c√°c ho·∫°t ƒë·ªông kh√°c tr√™n d·ªØ li·ªáu c√≥ c·∫•u tr√∫c.

Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng:

M·ªôt agent th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠.

C√¥ng c·ª•:

C√°c l·ªánh g·ªçi API ƒë·ªÉ ki·ªÉm tra h√†ng t·ªìn kho, l·∫•y tr·∫°ng th√°i ƒë∆°n h√†ng ho·∫∑c x·ª≠ l√Ω thanh to√°n.

Lu·ªìng c·ªßa Agent:

Ng∆∞·ªùi d√πng h·ªèi "S·∫£n ph·∫©m X c√≤n h√†ng kh√¥ng?", LLM g·ªçi API h√†ng t·ªìn kho, c√¥ng c·ª• tr·∫£ v·ªÅ s·ªë l∆∞·ª£ng t·ªìn kho, LLM th√¥ng b√°o cho ng∆∞·ªùi d√πng v·ªÅ t√¨nh tr·∫°ng h√†ng.

3. Th·ª±c hi·ªán c√°c Ph√©p t√≠nh v√† Ph√¢n t√≠ch D·ªØ li·ªáu: S·ª≠ d·ª•ng m√°y t√≠nh b√™n ngo√†i, th∆∞ vi·ªán ph√¢n t√≠ch d·ªØ li·ªáu ho·∫∑c c√°c c√¥ng c·ª• th·ªëng k√™.

Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng:

M·ªôt agent t√†i ch√≠nh.

C√¥ng c·ª•:

M·ªôt h√†m m√°y t√≠nh, m·ªôt API d·ªØ li·ªáu th·ªã tr∆∞·ªùng ch·ª©ng kho√°n, m·ªôt c√¥ng c·ª• b·∫£ng t√≠nh.

Lu·ªìng c·ªßa Agent:

Ng∆∞·ªùi d√πng h·ªèi "Gi√° hi·ªán t·∫°i c·ªßa AAPL l√† bao nhi√™u v√† t√≠nh l·ª£i nhu·∫≠n ti·ªÅm nƒÉng n·∫øu t√¥i mua 100 c·ªï phi·∫øu ·ªü m·ª©c 150 ƒë√¥ la?", LLM g·ªçi API ch·ª©ng kho√°n, l·∫•y gi√° hi·ªán t·∫°i, sau ƒë√≥ g·ªçi c√¥ng c·ª• m√°y t√≠nh, l·∫•y k·∫øt qu·∫£, ƒë·ªãnh d·∫°ng ph·∫£n h·ªìi.

4. G·ª≠i Li√™n l·∫°c: G·ª≠i email, tin nh·∫Øn ho·∫∑c th·ª±c hi·ªán c√°c l·ªánh g·ªçi API ƒë·∫øn c√°c d·ªãch v·ª• li√™n l·∫°c b√™n ngo√†i.

Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng:

M·ªôt agent tr·ª£ l√Ω c√° nh√¢n.

C√¥ng c·ª•:

M·ªôt API g·ª≠i email.

Lu·ªìng c·ªßa Agent:

Ng∆∞·ªùi d√πng n√≥i, "G·ª≠i email cho John v·ªÅ cu·ªôc h·ªçp ng√†y mai.", LLM g·ªçi m·ªôt c√¥ng c·ª• email v·ªõi ng∆∞·ªùi nh·∫≠n, ch·ªß ƒë·ªÅ v√† n·ªôi dung ƒë∆∞·ª£c tr√≠ch xu·∫•t t·ª´ y√™u c·∫ßu.

5. Th·ª±c thi M√£: Ch·∫°y c√°c ƒëo·∫°n m√£ trong m·ªôt m√¥i tr∆∞·ªùng an to√†n ƒë·ªÉ th·ª±c hi·ªán c√°c t√°c v·ª• c·ª• th·ªÉ.

Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng:

M·ªôt agent tr·ª£ l√Ω l·∫≠p tr√¨nh.

C√¥ng c·ª•:

M·ªôt tr√¨nh th√¥ng d·ªãch m√£ (code interpreter).

Lu·ªìng c·ªßa Agent:

Ng∆∞·ªùi d√πng cung c·∫•p m·ªôt ƒëo·∫°n m√£ Python v√† h·ªèi, "ƒêo·∫°n m√£ n√†y l√†m g√¨?", LLM s·ª≠ d·ª•ng c√¥ng c·ª• th√¥ng d·ªãch ƒë·ªÉ ch·∫°y m√£ v√† ph√¢n t√≠ch ƒë·∫ßu ra c·ªßa n√≥.

6. ƒêi·ªÅu khi·ªÉn c√°c H·ªá th·ªëng ho·∫∑c Thi·∫øt b·ªã kh√°c: T∆∞∆°ng t√°c v·ªõi c√°c thi·∫øt b·ªã nh√† th√¥ng minh, n·ªÅn t·∫£ng IoT ho·∫∑c c√°c h·ªá th·ªëng ƒë∆∞·ª£c k·∫øt n·ªëi kh√°c.

Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng:

M·ªôt agent nh√† th√¥ng minh.

C√¥ng c·ª•:

M·ªôt API ƒë·ªÉ ƒëi·ªÅu khi·ªÉn ƒë√®n th√¥ng minh.

Lu·ªìng c·ªßa Agent:

Ng∆∞·ªùi d√πng n√≥i, "T·∫Øt ƒë√®n ph√≤ng kh√°ch." LLM g·ªçi c√¥ng c·ª• nh√† th√¥ng minh v·ªõi l·ªánh v√† thi·∫øt b·ªã m·ª•c ti√™u.

S·ª≠ d·ª•ng C√¥ng c·ª• l√† th·ª© bi·∫øn ƒë·ªïi m·ªôt m√¥ h√¨nh ng√¥n ng·ªØ t·ª´ m·ªôt tr√¨nh t·∫°o vƒÉn b·∫£n th√†nh m·ªôt agent c√≥ kh·∫£ nƒÉng c·∫£m nh·∫≠n, suy lu·∫≠n v√† h√†nh ƒë·ªông trong th·∫ø gi·ªõi k·ªπ thu·∫≠t s·ªë ho·∫∑c v·∫≠t l√Ω (xem H√¨nh 1).

<figure> ![][../imgs/fig.5.1.Some_examples_of_an_Agent_using_Tools.png] <figcaption>H√¨nh 1: M·ªôt s·ªë v√≠ d·ª• v·ªÅ Agent s·ª≠ d·ª•ng C√¥ng c·ª•</figcaption> </figure>

V√≠ d·ª• M√£ th·ª±c h√†nh (LangChain)

Vi·ªác tri·ªÉn khai s·ª≠ d·ª•ng c√¥ng c·ª• trong framework LangChain l√† m·ªôt quy tr√¨nh g·ªìm hai giai ƒëo·∫°n. Ban ƒë·∫ßu, m·ªôt ho·∫∑c nhi·ªÅu c√¥ng c·ª• ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a, th∆∞·ªùng b·∫±ng c√°ch ƒë√≥ng g√≥i c√°c h√†m Python hi·ªán c√≥ ho·∫∑c c√°c th√†nh ph·∫ßn c√≥ th·ªÉ ch·∫°y kh√°c. Sau ƒë√≥, c√°c c√¥ng c·ª• n√†y ƒë∆∞·ª£c li√™n k·∫øt (bound) v·ªõi m·ªôt m√¥ h√¨nh ng√¥n ng·ªØ, qua ƒë√≥ c·∫•p cho m√¥ h√¨nh kh·∫£ nƒÉng t·∫°o ra m·ªôt y√™u c·∫ßu s·ª≠ d·ª•ng c√¥ng c·ª• c√≥ c·∫•u tr√∫c khi n√≥ x√°c ƒë·ªãnh r·∫±ng c·∫ßn ph·∫£i g·ªçi m·ªôt h√†m b√™n ngo√†i ƒë·ªÉ ƒë√°p ·ª©ng truy v·∫•n c·ªßa ng∆∞·ªùi d√πng.

Ph·∫ßn tri·ªÉn khai sau ƒë√¢y s·∫Ω minh h·ªça nguy√™n t·∫Øc n√†y b·∫±ng c√°ch tr∆∞·ªõc ti√™n ƒë·ªãnh nghƒ©a m·ªôt h√†m ƒë∆°n gi·∫£n ƒë·ªÉ m√¥ ph·ªèng m·ªôt c√¥ng c·ª• truy xu·∫•t th√¥ng tin. Sau ƒë√≥, m·ªôt agent s·∫Ω ƒë∆∞·ª£c x√¢y d·ª±ng v√† c·∫•u h√¨nh ƒë·ªÉ t·∫≠n d·ª•ng c√¥ng c·ª• n√†y nh·∫±m ph·∫£n h·ªìi l·∫°i ƒë·∫ßu v√†o c·ªßa ng∆∞·ªùi d√πng. Vi·ªác th·ª±c thi v√≠ d·ª• n√†y y√™u c·∫ßu c√†i ƒë·∫∑t c√°c th∆∞ vi·ªán LangChain c·ªët l√µi v√† m·ªôt g√≥i nh√† cung c·∫•p c·ª• th·ªÉ cho m√¥ h√¨nh. H∆°n n·ªØa, vi·ªác x√°c th·ª±c ƒë√∫ng c√°ch v·ªõi d·ªãch v·ª• m√¥ h√¨nh ng√¥n ng·ªØ ƒë√£ ch·ªçn, th∆∞·ªùng th√¥ng qua m·ªôt kh√≥a API ƒë∆∞·ª£c c·∫•u h√¨nh trong m√¥i tr∆∞·ªùng c·ª•c b·ªô, l√† m·ªôt ƒëi·ªÅu ki·ªán ti√™n quy·∫øt c·∫ßn thi·∫øt.

import os
import getpass
import asyncio
import nest_asyncio
import logging
from typing import List
from dotenv import load_dotenv

from langchain_google_genai import ChatGoogleGenerativeAI
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.tools import tool as langchain_tool
from langchain.agents import create_tool_calling_agent, AgentExecutor


# B·ªé CH√ö TH√çCH
# Nh·∫Øc ng∆∞·ªùi d√πng nh·∫≠p kh√≥a API m·ªôt c√°ch an to√†n v√† ƒë·∫∑t l√†m bi·∫øn m√¥i tr∆∞·ªùng
os.environ["GOOGLE_API_KEY"] = getpass.getpass("Enter your Google API key: ")
os.environ["OPENAI_API_KEY"] = getpass.getpass("Enter your OpenAI API key: ")

try:
    # C·∫ßn m·ªôt m√¥ h√¨nh c√≥ kh·∫£ nƒÉng g·ªçi h√†m/c√¥ng c·ª•.
    llm = ChatGoogleGenerativeAI(model="gemini-2.0-flash", temperature=0)
    print(f"‚úÖ Language model initialized: {llm.model}")
except Exception as e:
    print(f"üõë Error initializing language model: {e}")
    llm = None


# --- ƒê·ªãnh nghƒ©a m·ªôt C√¥ng c·ª• ---
@langchain_tool
def search_information(query: str) -> str:
    """
    Provides factual information on a given topic. Use this tool to find answers to phrases
    like 'capital of France' or 'weather in London?'.
    """
    print(f"\n--- üõ†Ô∏è Tool Called: search_information with query: '{query}' ---")

    # M√¥ ph·ªèng m·ªôt c√¥ng c·ª• t√¨m ki·∫øm v·ªõi m·ªôt t·ª´ ƒëi·ªÉn ch·ª©a c√°c k·∫øt qu·∫£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr∆∞·ªõc.
    simulated_results = {
        "weather in london": "The weather in London is currently cloudy with a temperature of 15¬∞C.",
        "capital of france": "The capital of France is Paris.",
        "population of earth": "The estimated population of Earth is around 8 billion people.",
        "tallest mountain": "Mount Everest is the tallest mountain above sea level.",
        "default": (
            f"Simulated search result for '{query}': No specific information found, "
            "but the topic seems interesting."
        ),
    }

    result = simulated_results.get(query.lower(), simulated_results["default"])
    print(f"--- TOOL RESULT: {result} ---")
    return result


tools = [search_information]


# --- T·∫°o m·ªôt Agent G·ªçi C√¥ng c·ª• ---
if llm:
    # M·∫´u prompt n√†y y√™u c·∫ßu m·ªôt ch·ªó gi·ªØ ch·ªó `agent_scratchpad` cho c√°c b∆∞·ªõc n·ªôi b·ªô c·ªßa agent.
    agent_prompt = ChatPromptTemplate.from_messages([
        ("system", "You are a helpful assistant."),
        ("human", "{input}"),
        ("placeholder", "{agent_scratchpad}"),
    ])

    # T·∫°o agent, li√™n k·∫øt LLM, c√°c c√¥ng c·ª• v√† prompt l·∫°i v·ªõi nhau.
    agent = create_tool_calling_agent(llm, tools, agent_prompt)

    # AgentExecutor l√† tr√¨nh th·ª±c thi (runtime) g·ªçi agent v√† th·ª±c thi c√°c c√¥ng c·ª• ƒë√£ ch·ªçn.
    # ƒê·ªëi s·ªë 'tools' kh√¥ng c·∫ßn thi·∫øt ·ªü ƒë√¢y v√¨ ch√∫ng ƒë√£ ƒë∆∞·ª£c li√™n k·∫øt v·ªõi agent.
    agent_executor = AgentExecutor(agent=agent, verbose=True, tools=tools)


async def run_agent_with_tool(query: str):
    """G·ªçi agent executor v·ªõi m·ªôt truy v·∫•n v√† in ra ph·∫£n h·ªìi cu·ªëi c√πng."""
    print(f"\n--- üèÉ Running Agent with Query: '{query}' ---")
    try:
        response = await agent_executor.ainvoke({"input": query})
        print("\n--- ‚úÖ Final Agent Response ---")
        print(response["output"])
    except Exception as e:
        print(f"\nüõë An error occurred during agent execution: {e}")


async def main():
    """Ch·∫°y t·∫•t c·∫£ c√°c truy v·∫•n c·ªßa agent ƒë·ªìng th·ªùi."""
    tasks = [
        run_agent_with_tool("What is the capital of France?"),
        run_agent_with_tool("What's the weather like in London?"),
        run_agent_with_tool("Tell me something about dogs.")  # S·∫Ω k√≠ch ho·∫°t ph·∫£n h·ªìi m·∫∑c ƒë·ªãnh c·ªßa c√¥ng c·ª•
    ]
    await asyncio.gather(*tasks)

nest_asyncio.apply()
asyncio.run(main())

"""
ƒêo·∫°n m√£ n√†y thi·∫øt l·∫≠p m·ªôt agent g·ªçi c√¥ng c·ª• b·∫±ng c√°ch s·ª≠ d·ª•ng th∆∞ vi·ªán LangChain v√† m√¥ h√¨nh Google Gemini. N√≥ ƒë·ªãnh nghƒ©a m·ªôt c√¥ng c·ª• "
search_information
" m√¥ ph·ªèng vi·ªác cung c·∫•p c√¢u tr·∫£ l·ªùi th·ª±c t·∫ø cho c√°c truy v·∫•n c·ª• th·ªÉ. C√¥ng c·ª• n√†y c√≥ c√°c ph·∫£n h·ªìi ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr∆∞·ªõc cho "weather in london," "capital of france," v√† "population of earth," v√† m·ªôt ph·∫£n h·ªìi m·∫∑c ƒë·ªãnh cho c√°c truy v·∫•n kh√°c. M·ªôt m√¥ h√¨nh "
ChatGoogleGenerativeAI
" ƒë∆∞·ª£c kh·ªüi t·∫°o, ƒë·∫£m b·∫£o n√≥ c√≥ kh·∫£ nƒÉng g·ªçi c√¥ng c·ª•. M·ªôt "
ChatPromptTemplate
" ƒë∆∞·ª£c t·∫°o ƒë·ªÉ h∆∞·ªõng d·∫´n t∆∞∆°ng t√°c c·ªßa agent. H√†m "
create_tool_calling_agent
" ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ k·∫øt h·ª£p m√¥ h√¨nh ng√¥n ng·ªØ, c√°c c√¥ng c·ª• v√† prompt th√†nh m·ªôt agent. M·ªôt "
AgentExecutor
" sau ƒë√≥ ƒë∆∞·ª£c thi·∫øt l·∫≠p ƒë·ªÉ qu·∫£n l√Ω vi·ªác th·ª±c thi c·ªßa agent v√† g·ªçi c√¥ng c·ª•. H√†m b·∫•t ƒë·ªìng b·ªô "
run_agent_with_tool
" ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a ƒë·ªÉ g·ªçi agent v·ªõi m·ªôt truy v·∫•n nh·∫•t ƒë·ªãnh v√† in k·∫øt qu·∫£. H√†m b·∫•t ƒë·ªìng b·ªô ch√≠nh ("main") chu·∫©n b·ªã nhi·ªÅu truy v·∫•n ƒë·ªÉ ch·∫°y ƒë·ªìng th·ªùi. C√°c truy v·∫•n n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ ki·ªÉm tra c·∫£ ph·∫£n h·ªìi c·ª• th·ªÉ v√† ph·∫£n h·ªìi m·∫∑c ƒë·ªãnh c·ªßa c√¥ng c·ª• "
search_information
". Cu·ªëi c√πng, l·ªánh g·ªçi "
asyncio.run(main())
" th·ª±c thi t·∫•t c·∫£ c√°c t√°c v·ª• c·ªßa agent. ƒêo·∫°n m√£ bao g·ªìm c√°c ki·ªÉm tra ƒë·ªÉ ƒë·∫£m b·∫£o LLM ƒë∆∞·ª£c kh·ªüi t·∫°o th√†nh c√¥ng tr∆∞·ªõc khi ti·∫øp t·ª•c thi·∫øt l·∫≠p v√† th·ª±c thi agent.

V√≠ d·ª• M√£ th·ª±c h√†nh (CrewAI)

ƒêo·∫°n m√£ n√†y cung c·∫•p m·ªôt v√≠ d·ª• th·ª±c t·∫ø v·ªÅ c√°ch tri·ªÉn khai g·ªçi h√†m (C√¥ng c·ª•) trong framework CrewAI. N√≥ thi·∫øt l·∫≠p m·ªôt k·ªãch b·∫£n ƒë∆°n gi·∫£n trong ƒë√≥ m·ªôt agent ƒë∆∞·ª£c trang b·ªã m·ªôt c√¥ng c·ª• ƒë·ªÉ tra c·ª©u th√¥ng tin. V√≠ d·ª• n√†y ƒë·∫∑c bi·ªát minh h·ªça vi·ªác l·∫•y gi√° c·ªï phi·∫øu m√¥ ph·ªèng b·∫±ng c√°ch s·ª≠ d·ª•ng agent v√† c√¥ng c·ª• n√†y.

# pip install crewai langchain-openai
import os
import logging

from crewai import Agent, Task, Crew
from crewai.tools import tool


# --- Th·ª±c h√†nh t·ªët nh·∫•t: C·∫•u h√¨nh Logging ---
# M·ªôt thi·∫øt l·∫≠p logging c∆° b·∫£n gi√∫p g·ª° l·ªói v√† theo d√µi qu√° tr√¨nh th·ª±c thi c·ªßa crew.
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')


# --- Thi·∫øt l·∫≠p Kh√≥a API c·ªßa b·∫°n ---
# ƒê·ªëi v·ªõi m√¥i tr∆∞·ªùng production, khuy·∫øn ngh·ªã s·ª≠ d·ª•ng ph∆∞∆°ng ph√°p an to√†n h∆°n ƒë·ªÉ qu·∫£n l√Ω kh√≥a
# nh∆∞ c√°c bi·∫øn m√¥i tr∆∞·ªùng ƒë∆∞·ª£c t·∫£i l√∫c ch·∫°y ho·∫∑c m·ªôt tr√¨nh qu·∫£n l√Ω b√≠ m·∫≠t (secret manager).
#
# ƒê·∫∑t bi·∫øn m√¥i tr∆∞·ªùng cho nh√† cung c·∫•p LLM b·∫°n ch·ªçn (v√≠ d·ª•: OPENAI_API_KEY)
# os.environ["OPENAI_API_KEY"] = "YOUR_API_KEY"
# os.environ["OPENAI_MODEL_NAME"] = "gpt-4o"


# --- 1. C√¥ng c·ª• ƒë∆∞·ª£c T√°i c·∫•u tr√∫c: Tr·∫£ v·ªÅ D·ªØ li·ªáu S·∫°ch ---
# C√¥ng c·ª• gi·ªù ƒë√¢y tr·∫£ v·ªÅ d·ªØ li·ªáu th√¥ (m·ªôt s·ªë th·ª±c) ho·∫∑c n√™u (raise) m·ªôt l·ªói Python ti√™u chu·∫©n.
# ƒêi·ªÅu n√†y l√†m cho n√≥ c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng nhi·ªÅu h∆°n v√† bu·ªôc agent ph·∫£i x·ª≠ l√Ω c√°c k·∫øt qu·∫£ m·ªôt c√°ch ƒë√∫ng ƒë·∫Øn.
@tool("Stock Price Lookup Tool")
def get_stock_price(ticker: str) -> float:
    """
    Fetches the latest simulated stock price for a given stock ticker symbol.
    Tr·∫£ v·ªÅ gi√° d∆∞·ªõi d·∫°ng s·ªë th·ª±c. N√™u (raise) l·ªói ValueError n·∫øu kh√¥ng t√¨m th·∫•y m√£ c·ªï phi·∫øu.
    """
    logging.info(f"Tool Call: get_stock_price for ticker '{ticker}'")

    simulated_prices = {
        "AAPL": 178.15,
        "GOOGL": 1750.30,
        "MSFT": 425.50,
    }

    price = simulated_prices.get(ticker.upper())
    if price is not None:
        return price
    else:
        # N√™u m·ªôt l·ªói c·ª• th·ªÉ t·ªët h∆°n l√† tr·∫£ v·ªÅ m·ªôt chu·ªói.
        # Agent ƒë∆∞·ª£c trang b·ªã ƒë·ªÉ x·ª≠ l√Ω c√°c ngo·∫°i l·ªá v√† c√≥ th·ªÉ quy·∫øt ƒë·ªãnh h√†nh ƒë·ªông ti·∫øp theo.
        raise ValueError(f"Simulated price for ticker '{ticker.upper()}' not found.")


# --- 2. ƒê·ªãnh nghƒ©a Agent ---
# ƒê·ªãnh nghƒ©a agent v·∫´n gi·ªØ nguy√™n, nh∆∞ng gi·ªù ƒë√¢y n√≥ s·∫Ω t·∫≠n d·ª•ng c√¥ng c·ª• ƒë√£ ƒë∆∞·ª£c c·∫£i ti·∫øn.
financial_analyst_agent = Agent(
    role='Senior Financial Analyst',
    goal='Analyze stock data using provided tools and report key prices.',
    backstory="You are an experienced financial analyst adept at using data sources to find stock information. You provide clear, direct answers.",
    verbose=True,
    tools=[get_stock_price],
    # Cho ph√©p ·ªßy quy·ªÅn c√≥ th·ªÉ h·ªØu √≠ch, nh∆∞ng kh√¥ng c·∫ßn thi·∫øt cho t√°c v·ª• ƒë∆°n gi·∫£n n√†y.
    allow_delegation=False,
)


# --- 3. T√°c v·ª• ƒë∆∞·ª£c Tinh ch·ªânh: H∆∞·ªõng d·∫´n R√µ r√†ng h∆°n v√† X·ª≠ l√Ω L·ªói ---
# M√¥ t·∫£ t√°c v·ª• c·ª• th·ªÉ h∆°n v√† h∆∞·ªõng d·∫´n agent c√°ch ph·∫£n ·ª©ng
# v·ªõi c·∫£ vi·ªác truy xu·∫•t d·ªØ li·ªáu th√†nh c√¥ng v√† c√°c l·ªói ti·ªÅm ·∫©n.
analyze_aapl_task = Task(
    description=(
        "What is the current simulated stock price for Apple (ticker: AAPL)? "
        "Use the 'Stock Price Lookup Tool' to find it. "
        "If the ticker is not found, you must report that you were unable to retrieve the price."
    ),
    expected_output=(
        "A single, clear sentence stating the simulated stock price for AAPL. "
        "For example: 'The simulated stock price for AAPL is $178.15.' "
        "If the price cannot be found, state that clearly."
    ),
    agent=financial_analyst_agent,
)


# --- 4. Th√†nh l·∫≠p Crew ---
# Crew ƒëi·ªÅu ph·ªëi c√°ch agent v√† t√°c v·ª• l√†m vi·ªác c√πng nhau.
financial_crew = Crew(
    agents=[financial_analyst_agent],
    tasks=[analyze_aapl_task],
    verbose=True  # ƒê·∫∑t th√†nh False ƒë·ªÉ c√≥ √≠t log chi ti·∫øt h∆°n trong m√¥i tr∆∞·ªùng production
)


# --- 5. Ch·∫°y Crew trong m·ªôt Kh·ªëi Th·ª±c thi Ch√≠nh ---
# S·ª≠ d·ª•ng kh·ªëi __name__ == "__main__": l√† m·ªôt th·ª±c h√†nh t·ªët ti√™u chu·∫©n c·ªßa Python.
def main():
    """H√†m ch√≠nh ƒë·ªÉ ch·∫°y crew."""
    # Ki·ªÉm tra kh√≥a API tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu ƒë·ªÉ tr√°nh l·ªói l√∫c ch·∫°y.
    if not os.environ.get("OPENAI_API_KEY"):
        print("ERROR: The OPENAI_API_KEY environment variable is not set.")
        print("Please set it before running the script.")
        return

    print("\n## Starting the Financial Crew...")
    print("---------------------------------")

    # Ph∆∞∆°ng th·ª©c kickoff b·∫Øt ƒë·∫ßu th·ª±c thi.
    result = financial_crew.kickoff()

    print("\n---------------------------------")
    print("## Crew execution finished.")
    print("\nFinal Result:\n", result)


if __name__ == "__main__":
    main()

"""
ƒêo·∫°n m√£ n√†y minh h·ªça m·ªôt ·ª©ng d·ª•ng ƒë∆°n gi·∫£n s·ª≠ d·ª•ng th∆∞ vi·ªán Crew.ai ƒë·ªÉ m√¥ ph·ªèng m·ªôt t√°c v·ª• ph√¢n t√≠ch t√†i ch√≠nh. N√≥ ƒë·ªãnh nghƒ©a m·ªôt c√¥ng c·ª• t√πy ch·ªânh, "
get_stock_price
", m√¥ ph·ªèng vi·ªác tra c·ª©u gi√° c·ªï phi·∫øu cho c√°c m√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr∆∞·ªõc. C√¥ng c·ª• ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ tr·∫£ v·ªÅ m·ªôt s·ªë th·ª±c (floating-point number) cho c√°c m√£ h·ª£p l·ªá ho·∫∑c n√™u (raise) l·ªói "
ValueError
" cho c√°c m√£ kh√¥ng h·ª£p l·ªá. M·ªôt "
Agent
" c·ªßa Crew.ai t√™n l√† "
financial_analyst_agent
" ƒë∆∞·ª£c t·∫°o v·ªõi vai tr√≤ l√† m·ªôt Nh√† ph√¢n t√≠ch T√†i ch√≠nh C·∫•p cao. Agent n√†y ƒë∆∞·ª£c cung c·∫•p c√¥ng c·ª• "
get_stock_price
" ƒë·ªÉ t∆∞∆°ng t√°c. M·ªôt "
Task
" ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a, "
analyze_aapl_task
", h∆∞·ªõng d·∫´n c·ª• th·ªÉ agent t√¨m gi√° c·ªï phi·∫øu m√¥ ph·ªèng cho AAPL b·∫±ng c√°ch s·ª≠ d·ª•ng c√¥ng c·ª•. M√¥ t·∫£ t√°c v·ª• bao g·ªìm c√°c h∆∞·ªõng d·∫´n r√µ r√†ng v·ªÅ c√°ch x·ª≠ l√Ω c·∫£ tr∆∞·ªùng h·ª£p th√†nh c√¥ng v√† th·∫•t b·∫°i khi s·ª≠ d·ª•ng c√¥ng c·ª•. M·ªôt "
Crew
" ƒë∆∞·ª£c t·∫≠p h·ª£p, bao g·ªìm "
financial_analyst_agent
" v√† "
analyze_aapl_task
". C√†i ƒë·∫∑t "
verbose
" ƒë∆∞·ª£c b·∫≠t cho c·∫£ agent v√† crew ƒë·ªÉ cung c·∫•p ghi log chi ti·∫øt trong qu√° tr√¨nh th·ª±c thi. Ph·∫ßn ch√≠nh c·ªßa t·∫≠p l·ªánh ch·∫°y t√°c v·ª• c·ªßa crew b·∫±ng ph∆∞∆°ng th·ª©c "
kickoff()
" trong m·ªôt kh·ªëi "
if __name__ == "__main__":
" ti√™u chu·∫©n. Tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu crew, n√≥ ki·ªÉm tra xem bi·∫øn m√¥i tr∆∞·ªùng "
OPENAI_API_KEY
" ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t hay ch∆∞a, ƒëi·ªÅu n√†y l√† b·∫Øt bu·ªôc ƒë·ªÉ agent ho·∫°t ƒë·ªông. K·∫øt qu·∫£ th·ª±c thi c·ªßa crew, t·ª©c l√† ƒë·∫ßu ra c·ªßa t√°c v·ª•, sau ƒë√≥ ƒë∆∞·ª£c in ra console. ƒêo·∫°n m√£ c≈©ng bao g·ªìm c·∫•u h√¨nh logging c∆° b·∫£n ƒë·ªÉ theo d√µi t·ªët h∆°n c√°c h√†nh ƒë·ªông v√† l·ªánh g·ªçi c√¥ng c·ª• c·ªßa crew. N√≥ s·ª≠ d·ª•ng c√°c bi·∫øn m√¥i tr∆∞·ªùng ƒë·ªÉ qu·∫£n l√Ω kh√≥a API, m·∫∑c d√π c√≥ l∆∞u √Ω r·∫±ng c√°c ph∆∞∆°ng ph√°p an to√†n h∆°n ƒë∆∞·ª£c khuy·∫øn ngh·ªã cho m√¥i tr∆∞·ªùng production. T√≥m l·∫°i, logic c·ªët l√µi cho th·∫•y c√°ch ƒë·ªãnh nghƒ©a c√°c c√¥ng c·ª•, agent v√† t√°c v·ª• ƒë·ªÉ t·∫°o ra m·ªôt quy tr√¨nh l√†m vi·ªác c·ªông t√°c trong Crew.ai.

M√£ th·ª±c h√†nh (Google ADK)

Google Agent Developer Kit (ADK) bao g·ªìm m·ªôt th∆∞ vi·ªán c√°c c√¥ng c·ª• ƒë∆∞·ª£c t√≠ch h·ª£p s·∫µn c√≥ th·ªÉ ƒë∆∞·ª£c k·∫øt h·ª£p tr·ª±c ti·∫øp v√†o c√°c kh·∫£ nƒÉng c·ªßa agent.

Google search: M·ªôt v√≠ d·ª• ch√≠nh c·ªßa th√†nh ph·∫ßn nh∆∞ v·∫≠y l√† c√¥ng c·ª• Google Search. C√¥ng c·ª• n√†y ph·ª•c v·ª• nh∆∞ m·ªôt giao di·ªán tr·ª±c ti·∫øp v·ªõi c√¥ng c·ª• t√¨m ki·∫øm Google, trang b·ªã cho agent ch·ª©c nƒÉng th·ª±c hi·ªán t√¨m ki·∫øm tr√™n web v√† truy xu·∫•t th√¥ng tin b√™n ngo√†i.

from google.adk.agents import Agent
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService
from google.adk.tools import google_search
from google.genai import types
import nest_asyncio
import asyncio


# ƒê·ªãnh nghƒ©a c√°c bi·∫øn c·∫ßn thi·∫øt cho vi·ªác thi·∫øt l·∫≠p Session v√† th·ª±c thi Agent
APP_NAME = "Google Search_agent"
USER_ID = "user1234"
SESSION_ID = "1234"


# ƒê·ªãnh nghƒ©a Agent c√≥ quy·ªÅn truy c·∫≠p v√†o c√¥ng c·ª• t√¨m ki·∫øm
root_agent = ADKAgent(
    name="basic_search_agent",
    model="gemini-2.0-flash-exp",
    description="Agent to answer questions using Google Search.",
    instruction="I can answer your questions by searching the internet. Just ask me anything!",
    tools=[google_search]  # Google Search l√† m·ªôt c√¥ng c·ª• ƒë∆∞·ª£c x√¢y d·ª±ng s·∫µn ƒë·ªÉ th·ª±c hi·ªán c√°c t√¨m ki·∫øm c·ªßa Google.
)


# T∆∞∆°ng t√°c Agent
async def call_agent(query):
    """
    H√†m tr·ª£ gi√∫p ƒë·ªÉ g·ªçi agent v·ªõi m·ªôt truy v·∫•n.
    """
    # Session v√† Runner
    session_service = InMemorySessionService()
    session = await session_service.create_session(
        app_name=APP_NAME,
        user_id=USER_ID,
        session_id=SESSION_ID,
    )
    runner = Runner(agent=root_agent, app_name=APP_NAME, session_service=session_service)

    content = types.Content(role='user', parts=[types.Part(text=query)])
    events = runner.run(user_id=USER_ID, session_id=SESSION_ID, new_message=content)

    for event in events:
        if event.is_final_response():
            final_response = event.content.parts[0].text
            print("Agent Response: ", final_response)

nest_asyncio.apply()
asyncio.run(call_agent("what's the latest ai news?"))

"""
ƒêo·∫°n m√£ n√†y minh h·ªça c√°ch t·∫°o v√† s·ª≠ d·ª•ng m·ªôt agent c∆° b·∫£n ƒë∆∞·ª£c cung c·∫•p b·ªüi Google ADK cho Python. Agent n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ tr·∫£ l·ªùi c√°c c√¢u h·ªèi b·∫±ng c√°ch s·ª≠ d·ª•ng Google Search nh∆∞ m·ªôt c√¥ng c·ª•. ƒê·∫ßu ti√™n, c√°c th∆∞ vi·ªán c·∫ßn thi·∫øt t·ª´ IPython, google.adk v√† google.genai ƒë∆∞·ª£c nh·∫≠p v√†o. C√°c h·∫±ng s·ªë cho t√™n ·ª©ng d·ª•ng, ID ng∆∞·ªùi d√πng v√† ID phi√™n ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a. M·ªôt th·ª±c th·ªÉ "
Agent
" c√≥ t√™n "basic_search_agent" ƒë∆∞·ª£c t·∫°o v·ªõi m√¥ t·∫£ v√† h∆∞·ªõng d·∫´n ch·ªâ r√µ m·ª•c ƒë√≠ch c·ªßa n√≥. N√≥ ƒë∆∞·ª£c c·∫•u h√¨nh ƒë·ªÉ s·ª≠ d·ª•ng c√¥ng c·ª• "
Google Search
", m·ªôt c√¥ng c·ª• ƒë∆∞·ª£c x√¢y d·ª±ng s·∫µn do ADK cung c·∫•p. M·ªôt "
InMemorySessionService
" (xem Ch∆∞∆°ng 8) ƒë∆∞·ª£c kh·ªüi t·∫°o ƒë·ªÉ qu·∫£n l√Ω c√°c phi√™n cho agent. M·ªôt phi√™n m·ªõi ƒë∆∞·ª£c t·∫°o cho ·ª©ng d·ª•ng, ID ng∆∞·ªùi d√πng v√† ID phi√™n ƒë√£ ch·ªâ ƒë·ªãnh. M·ªôt "
Runner
" ƒë∆∞·ª£c kh·ªüi t·∫°o, li√™n k·∫øt agent ƒë√£ t·∫°o v·ªõi d·ªãch v·ª• phi√™n. Runner n√†y ch·ªãu tr√°ch nhi·ªám th·ª±c thi c√°c t∆∞∆°ng t√°c c·ªßa agent trong m·ªôt phi√™n. M·ªôt h√†m tr·ª£ gi√∫p "
call_agent
" ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a ƒë·ªÉ ƒë∆°n gi·∫£n h√≥a qu√° tr√¨nh g·ª≠i truy v·∫•n ƒë·∫øn agent v√† x·ª≠ l√Ω ph·∫£n h·ªìi. B√™n trong "
call_agent
", truy v·∫•n c·ªßa ng∆∞·ªùi d√πng ƒë∆∞·ª£c ƒë·ªãnh d·∫°ng th√†nh m·ªôt ƒë·ªëi t∆∞·ª£ng "
types.Content
" v·ªõi vai tr√≤ 'user'. Ph∆∞∆°ng th·ª©c "
runner.run
" ƒë∆∞·ª£c g·ªçi v·ªõi ID ng∆∞·ªùi d√πng, ID phi√™n v√† n·ªôi dung tin nh·∫Øn m·ªõi. Ph∆∞∆°ng th·ª©c "
runner.run
" tr·∫£ v·ªÅ m·ªôt danh s√°ch c√°c s·ª± ki·ªán ƒë·∫°i di·ªán cho c√°c h√†nh ƒë·ªông v√† ph·∫£n h·ªìi c·ªßa agent. ƒêo·∫°n m√£ l·∫∑p qua c√°c s·ª± ki·ªán n√†y ƒë·ªÉ t√¨m ph·∫£n h·ªìi cu·ªëi c√πng. N·∫øu m·ªôt s·ª± ki·ªán ƒë∆∞·ª£c x√°c ƒë·ªãnh l√† ph·∫£n h·ªìi cu·ªëi c√πng, n·ªôi dung vƒÉn b·∫£n c·ªßa ph·∫£n h·ªìi ƒë√≥ s·∫Ω ƒë∆∞·ª£c tr√≠ch xu·∫•t. Ph·∫£n h·ªìi c·ªßa agent ƒë√£ tr√≠ch xu·∫•t sau ƒë√≥ ƒë∆∞·ª£c in ra console. Cu·ªëi c√πng, h√†m "
call_agent
" ƒë∆∞·ª£c g·ªçi v·ªõi truy v·∫•n "what's the latest ai news?" ƒë·ªÉ minh h·ªça agent trong h√†nh ƒë·ªông.

Th·ª±c thi m√£:

Google ADK c√≥ c√°c th√†nh ph·∫ßn t√≠ch h·ª£p cho c√°c t√°c v·ª• chuy√™n bi·ªát, bao g·ªìm m·ªôt m√¥i tr∆∞·ªùng ƒë·ªÉ th·ª±c thi m√£ ƒë·ªông. C√¥ng c·ª• "
built_in_code_execution
" cung c·∫•p cho agent m·ªôt tr√¨nh th√¥ng d·ªãch Python trong m√¥i tr∆∞·ªùng sandbox. ƒêi·ªÅu n√†y cho ph√©p m√¥ h√¨nh vi·∫øt v√† ch·∫°y m√£ ƒë·ªÉ th·ª±c hi·ªán c√°c t√°c v·ª• t√≠nh to√°n, thao t√°c v·ªõi c√°c c·∫•u tr√∫c d·ªØ li·ªáu v√† th·ª±c thi c√°c k·ªãch b·∫£n th·ªß t·ª•c. Ch·ª©c nƒÉng nh∆∞ v·∫≠y r·∫•t quan tr·ªçng ƒë·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ ƒë√≤i h·ªèi logic t·∫•t ƒë·ªãnh v√† c√°c ph√©p t√≠nh ch√≠nh x√°c, v·ªën n·∫±m ngo√†i ph·∫°m vi c·ªßa vi·ªác t·∫°o ng√¥n ng·ªØ x√°c su·∫•t ƒë∆°n thu·∫ßn.

import os
import getpass
import asyncio
import nest_asyncio
import logging
from typing import List

from dotenv import load_dotenv
from google.adk.agents import Agent as ADKAgent, LlmAgent
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService
from google.adk.tools import google_search
from google.adk.code_executors import BuiltInCodeExecutor
from google.genai import types


# ƒê·ªãnh nghƒ©a c√°c bi·∫øn c·∫ßn thi·∫øt cho vi·ªác thi·∫øt l·∫≠p Session v√† th·ª±c thi Agent
APP_NAME = "calculator"
USER_ID = "user1234"
SESSION_ID = "session_code_exec_async"


# ƒê·ªãnh nghƒ©a Agent
code_agent = LlmAgent(
    name="calculator_agent",
    model="gemini-2.0-flash",
    code_executor=BuiltInCodeExecutor(),
    instruction="""
You are a calculator agent.
  When given a mathematical expression, write and execute Python code to calculate the result.
  Return only the final numerical result as plain text, without markdown or code blocks.
  """,
    description="Executes Python code to perform calculations.",
)


# T∆∞∆°ng t√°c Agent (B·∫•t ƒë·ªìng b·ªô)
async def call_agent_async(query):
    # Session v√† Runner
    session_service = InMemorySessionService()
    session = await session_service.create_session(
        app_name=APP_NAME,
        user_id=USER_ID,
        session_id=SESSION_ID,
    )
    runner = Runner(agent=code_agent, app_name=APP_NAME, session_service=session_service)

    content = types.Content(role="user", parts=[types.Part(text=query)])
    print(f"\n--- Running Query: {query} ---")

    final_response_text = "No final text response captured."

    try:
        # S·ª≠ d·ª•ng run_async
        async for event in runner.run_async(
            user_id=USER_ID,
            session_id=SESSION_ID,
            new_message=content,
        ):
            print(f"Event ID: {event.id}, Author: {event.author}")

            # --- Ki·ªÉm tra c√°c ph·∫ßn c·ª• th·ªÉ TR∆Ø·ªöC TI√äN ---
            # has_specific_part = False
            if event.content and event.content.parts and event.is_final_response():
                for part in event.content.parts:  # L·∫∑p qua t·∫•t c·∫£ c√°c ph·∫ßn
                    if part.executable_code:
                        # Truy c·∫≠p chu·ªói m√£ th·ª±c t·∫ø th√¥ng qua .code
                        print(
                            f"  Debug: Agent generated code:\n```python\n{part.executable_code.code}\n```"
                        )
                        has_specific_part = True
                    elif part.code_execution_result:
                        # Truy c·∫≠p outcome v√† output m·ªôt c√°ch ch√≠nh x√°c
                        print(
                            f"  Debug: Code Execution Result: {part.code_execution_result.outcome} - Output:\n{part.code_execution_result.output}"
                        )
                        has_specific_part = True
                    # C≈©ng in b·∫•t k·ª≥ ph·∫ßn vƒÉn b·∫£n n√†o ƒë∆∞·ª£c t√¨m th·∫•y trong b·∫•t k·ª≥ s·ª± ki·ªán n√†o ƒë·ªÉ g·ª° l·ªói
                    elif part.text and not part.text.isspace():
                        print(f"  Text: '{part.text.strip()}'")
                        # ƒê·ª´ng ƒë·∫∑t has_specific_part=True ·ªü ƒë√¢y, v√¨ ch√∫ng ta mu·ªën logic ph·∫£n h·ªìi cu·ªëi c√πng b√™n d∆∞·ªõi

                # --- Ki·ªÉm tra ph·∫£n h·ªìi cu·ªëi c√πng SAU c√°c ph·∫ßn c·ª• th·ªÉ ---
                text_parts = [part.text for part in event.content.parts if part.text]
                final_result = "".join(text_parts)
                print(f"==> Final Agent Response: {final_result}")

    except Exception as e:
        print(f"ERROR during agent run: {e}")

    print("-" * 30)


# H√†m async ch√≠nh ƒë·ªÉ ch·∫°y c√°c v√≠ d·ª•
async def main():
    await call_agent_async("Calculate the value of (5 + 7) * 3")
    await call_agent_async("What is 10 factorial?")


# Th·ª±c thi h√†m async ch√≠nh
try:
    nest_asyncio.apply()
    asyncio.run(main())
except RuntimeError as e:
    # X·ª≠ l√Ω l·ªói c·ª• th·ªÉ khi ch·∫°y asyncio.run trong m·ªôt v√≤ng l·∫∑p s·ª± ki·ªán ƒë√£ ch·∫°y (nh∆∞ Jupyter/Colab)
    if "cannot be called from a running event loop" in str(e):
        print("\nRunning in an existing event loop (like Colab/Jupyter).")
        print("Please run `await main()` in a notebook cell instead.")
        # N·∫øu trong m·ªôt m√¥i tr∆∞·ªùng t∆∞∆°ng t√°c nh∆∞ notebook, b·∫°n c√≥ th·ªÉ c·∫ßn ch·∫°y:
        # await main()
    else:
        raise e  # N√™u l·∫°i c√°c l·ªói runtime kh√°c

"""
T·∫≠p l·ªánh n√†y s·ª≠ d·ª•ng B·ªô c√¥ng c·ª• Ph√°t tri·ªÉn Agent c·ªßa Google (ADK) ƒë·ªÉ t·∫°o ra m·ªôt agent gi·∫£i quy·∫øt c√°c b√†i to√°n b·∫±ng c√°ch vi·∫øt v√† th·ª±c thi m√£ Python. N√≥ ƒë·ªãnh nghƒ©a m·ªôt "
LlmAgent
" ƒë∆∞·ª£c h∆∞·ªõng d·∫´n c·ª• th·ªÉ ƒë·ªÉ ho·∫°t ƒë·ªông nh∆∞ m·ªôt m√°y t√≠nh, trang b·ªã cho n√≥ c√¥ng c·ª• "
built_in_code_execution
". Logic ch√≠nh n·∫±m trong h√†m "
call_agent_async
", h√†m n√†y g·ª≠i m·ªôt truy v·∫•n c·ªßa ng∆∞·ªùi d√πng ƒë·∫øn "
runner
" c·ªßa agent v√† x·ª≠ l√Ω c√°c s·ª± ki·ªán k·∫øt qu·∫£. B√™n trong h√†m n√†y, m·ªôt v√≤ng l·∫∑p b·∫•t ƒë·ªìng b·ªô l·∫∑p qua c√°c s·ª± ki·ªán, in ra m√£ Python ƒë∆∞·ª£c t·∫°o v√† k·∫øt qu·∫£ th·ª±c thi c·ªßa n√≥ ƒë·ªÉ g·ª° l·ªói. ƒêo·∫°n m√£ ph√¢n bi·ªát c·∫©n th·∫≠n gi·ªØa c√°c b∆∞·ªõc trung gian n√†y v√† s·ª± ki·ªán cu·ªëi c√πng ch·ª©a c√¢u tr·∫£ l·ªùi b·∫±ng s·ªë. Cu·ªëi c√πng, m·ªôt h√†m "
main
" ch·∫°y agent v·ªõi hai bi·ªÉu th·ª©c to√°n h·ªçc kh√°c nhau ƒë·ªÉ minh h·ªça kh·∫£ nƒÉng th·ª±c hi·ªán c√°c ph√©p t√≠nh c·ªßa n√≥.

T√¨m ki·∫øm doanh nghi·ªáp:

ƒêo·∫°n m√£ n√†y ƒë·ªãnh nghƒ©a m·ªôt ·ª©ng d·ª•ng Google ADK b·∫±ng th∆∞ vi·ªán "
google.adk
" trong Python. N√≥ ƒë·∫∑c bi·ªát s·ª≠ d·ª•ng m·ªôt "
VSearchAgent
", ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ tr·∫£ l·ªùi c√°c c√¢u h·ªèi b·∫±ng c√°ch t√¨m ki·∫øm m·ªôt kho d·ªØ li·ªáu (datastore) Vertex AI Search c·ª• th·ªÉ. ƒêo·∫°n m√£ kh·ªüi t·∫°o m·ªôt "
VSearchAgent
" c√≥ t√™n "q2_strategy_vsearch_agent", cung c·∫•p m√¥ t·∫£, m√¥ h√¨nh s·ª≠ d·ª•ng ("gemini-2.0-flash-exp") v√† ID c·ªßa kho d·ªØ li·ªáu Vertex AI Search. "
DATASTORE_ID
" d·ª± ki·∫øn s·∫Ω ƒë∆∞·ª£c ƒë·∫∑t l√†m bi·∫øn m√¥i tr∆∞·ªùng. Sau ƒë√≥, n√≥ thi·∫øt l·∫≠p m·ªôt "
Runner
" cho agent, s·ª≠ d·ª•ng "
InMemorySessionService
" ƒë·ªÉ qu·∫£n l√Ω l·ªãch s·ª≠ cu·ªôc tr√≤ chuy·ªán. M·ªôt h√†m b·∫•t ƒë·ªìng b·ªô "
call_vsearch_agent_async
" ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a ƒë·ªÉ t∆∞∆°ng t√°c v·ªõi agent. H√†m n√†y nh·∫≠n m·ªôt truy v·∫•n, x√¢y d·ª±ng m·ªôt ƒë·ªëi t∆∞·ª£ng n·ªôi dung tin nh·∫Øn v√† g·ªçi ph∆∞∆°ng th·ª©c "
run_async
" c·ªßa runner ƒë·ªÉ g·ª≠i truy v·∫•n ƒë·∫øn agent. H√†m n√†y sau ƒë√≥ truy·ªÅn (stream) ph·∫£n h·ªìi c·ªßa agent tr·ªü l·∫°i console khi n√≥ ƒë·∫øn. N√≥ c≈©ng in th√¥ng tin v·ªÅ ph·∫£n h·ªìi cu·ªëi c√πng, bao g·ªìm b·∫•t k·ª≥ ghi nh·∫≠n ngu·ªìn (source attributions) n√†o t·ª´ kho d·ªØ li·ªáu. X·ª≠ l√Ω l·ªói ƒë∆∞·ª£c bao g·ªìm ƒë·ªÉ b·∫Øt c√°c ngo·∫°i l·ªá trong qu√° tr√¨nh th·ª±c thi c·ªßa agent, cung c·∫•p c√°c th√¥ng b√°o th√¥ng tin v·ªÅ c√°c v·∫•n ƒë·ªÅ ti·ªÅm ·∫©n nh∆∞ ID kho d·ªØ li·ªáu kh√¥ng ch√≠nh x√°c ho·∫∑c thi·∫øu quy·ªÅn. M·ªôt h√†m b·∫•t ƒë·ªìng b·ªô kh√°c "
run_vsearch_example
" ƒë∆∞·ª£c cung c·∫•p ƒë·ªÉ minh h·ªça c√°ch g·ªçi agent v·ªõi c√°c truy v·∫•n v√≠ d·ª•. Kh·ªëi th·ª±c thi ch√≠nh ki·ªÉm tra xem "
DATASTORE_ID
" ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t hay ch∆∞a v√† sau ƒë√≥ ch·∫°y v√≠ d·ª• b·∫±ng "
asyncio.run
". N√≥ bao g·ªìm m·ªôt ki·ªÉm tra ƒë·ªÉ x·ª≠ l√Ω c√°c tr∆∞·ªùng h·ª£p m√£ ƒë∆∞·ª£c ch·∫°y trong m·ªôt m√¥i tr∆∞·ªùng ƒë√£ c√≥ v√≤ng l·∫∑p s·ª± ki·ªán ƒëang ch·∫°y, nh∆∞ m·ªôt m√°y t√≠nh x√°ch tay Jupyter (Jupyter notebook).

import os
import asyncio

from google.genai import types
from google.adk import agents
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService


# --- C·∫•u h√¨nh ---
# ƒê·∫£m b·∫£o b·∫°n ƒë√£ ƒë·∫∑t c√°c bi·∫øn m√¥i tr∆∞·ªùng GOOGLE_API_KEY v√† DATASTORE_ID
# V√≠ d·ª•:
# os.environ["GOOGLE_API_KEY"] = "YOUR_API_KEY"
# os.environ["DATASTORE_ID"] = "YOUR_DATASTORE_ID"
DATASTORE_ID = os.environ.get("DATASTORE_ID")


# --- C√°c h·∫±ng s·ªë ·ª©ng d·ª•ng ---
APP_NAME = "vsearch_app"
USER_ID = "user_123"   # ID ng∆∞·ªùi d√πng v√≠ d·ª•
SESSION_ID = "session_456"  # ID phi√™n v√≠ d·ª•


# --- ƒê·ªãnh nghƒ©a Agent (ƒê√£ c·∫≠p nh·∫≠t v·ªõi m√¥ h√¨nh m·ªõi h∆°n t·ª´ h∆∞·ªõng d·∫´n) ---
vsearch_agent = agents.VSearchAgent(
    name="q2_strategy_vsearch_agent",
    description="Answers questions about Q2 strategy documents using Vertex AI Search.",
    model="gemini-2.0-flash-exp",  # M√¥ h√¨nh ƒë∆∞·ª£c c·∫≠p nh·∫≠t d·ª±a tr√™n c√°c v√≠ d·ª• c·ªßa h∆∞·ªõng d·∫´n
    datastore_id=DATASTORE_ID,
    model_parameters={"temperature": 0.0},
)


# --- Kh·ªüi t·∫°o Runner v√† Session ---
runner = Runner(
    agent=vsearch_agent,
    app_name=APP_NAME,
    session_service=InMemorySessionService(),
)


# --- Logic G·ªçi Agent ---
async def call_vsearch_agent_async(query: str):
    """Kh·ªüi t·∫°o m·ªôt phi√™n v√† truy·ªÅn (stream) ph·∫£n h·ªìi c·ªßa agent."""
    print(f"User: {query}")
    print("Agent: ", end="", flush=True)

    try:
        # X√¢y d·ª±ng n·ªôi dung tin nh·∫Øn m·ªôt c√°ch ch√≠nh x√°c
        content = types.Content(role="user", parts=[types.Part(text=query)])

        # X·ª≠ l√Ω c√°c s·ª± ki·ªán khi ch√∫ng ƒë·∫øn t·ª´ runner b·∫•t ƒë·ªìng b·ªô
        async for event in runner.run_async(
            user_id=USER_ID,
            session_id=SESSION_ID,
            new_message=content,
        ):
            # ƒê·ªÉ truy·ªÅn (stream) vƒÉn b·∫£n ph·∫£n h·ªìi theo t·ª´ng token
            if hasattr(event, "content_part_delta") and event.content_part_delta:
                print(event.content_part_delta.text, end="", flush=True)

            # X·ª≠ l√Ω ph·∫£n h·ªìi cu·ªëi c√πng v√† si√™u d·ªØ li·ªáu (metadata) li√™n quan c·ªßa n√≥
            if event.is_final_response():
                print()  # Xu·ªëng d√≤ng m·ªõi sau ph·∫£n h·ªìi truy·ªÅn (stream)
                if event.grounding_metadata:
                    print(
                        f"  (Source Attributions: "
                        f"{len(event.grounding_metadata.grounding_attributions)} sources found)"
                    )
                else:
                    print("  (No grounding metadata found)")
                print("-" * 30)

    except Exception as e:
        print(f"\nAn error occurred: {e}")
        print(
            "Please ensure your datastore ID is correct and that the service account "
            "has the necessary permissions."
        )
        print("-" * 30)


# --- Ch·∫°y V√≠ d·ª• ---
async def run_vsearch_example():
    # Thay th·∫ø b·∫±ng m·ªôt c√¢u h·ªèi li√™n quan ƒë·∫øn n·ªôi dung kho d·ªØ li·ªáu C·ª¶A B·∫†N
    await call_vsearch_agent_async("Summarize the main points about the Q2 strategy document.")
    await call_vsearch_agent_async("What safety procedures are mentioned for lab X?")


# --- Th·ª±c thi ---
if __name__ == "__main__":
    if not DATASTORE_ID:
        print("Error: DATASTORE_ID environment variable is not set.")
    else:
        try:
            asyncio.run(run_vsearch_example())
        except RuntimeError as e:
            # ƒêi·ªÅu n√†y x·ª≠ l√Ω c√°c tr∆∞·ªùng h·ª£p khi asyncio.run ƒë∆∞·ª£c g·ªçi trong m·ªôt m√¥i tr∆∞·ªùng
            # ƒë√£ c√≥ m·ªôt v√≤ng l·∫∑p s·ª± ki·ªán ƒëang ch·∫°y (nh∆∞ Jupyter notebook).
            if "cannot be called from a running event loop" in str(e):
                print("Skipp
Nh√¨n chung, ƒëo·∫°n m√£ n√†y cung c·∫•p m·ªôt framework c∆° b·∫£n ƒë·ªÉ x√¢y d·ª±ng m·ªôt ·ª©ng d·ª•ng AI ƒë√†m tho·∫°i t·∫≠n d·ª•ng Vertex AI Search ƒë·ªÉ tr·∫£ l·ªùi c√°c c√¢u h·ªèi d·ª±a tr√™n th√¥ng tin ƒë∆∞·ª£c l∆∞u tr·ªØ trong m·ªôt kho d·ªØ li·ªáu. N√≥ minh h·ªça c√°ch ƒë·ªãnh nghƒ©a m·ªôt agent, thi·∫øt l·∫≠p m·ªôt runner v√† t∆∞∆°ng t√°c v·ªõi agent m·ªôt c√°ch b·∫•t ƒë·ªìng b·ªô trong khi truy·ªÅn (stream) ph·∫£n h·ªìi. Tr·ªçng t√¢m l√† truy xu·∫•t v√† t·ªïng h·ª£p th√¥ng tin t·ª´ m·ªôt kho d·ªØ li·ªáu c·ª• th·ªÉ ƒë·ªÉ tr·∫£ l·ªùi c√°c truy v·∫•n c·ªßa ng∆∞·ªùi d√πng.

Vertex Extensions (Ti·ªán √≠ch m·ªü r·ªông c·ªßa Vertex):

M·ªôt ti·ªán √≠ch m·ªü r·ªông c·ªßa Vertex AI l√† m·ªôt tr√¨nh bao b·ªçc API c√≥ c·∫•u tr√∫c (structured API wrapper) cho ph√©p m√¥ h√¨nh k·∫øt n·ªëi v·ªõi c√°c API b√™n ngo√†i ƒë·ªÉ x·ª≠ l√Ω d·ªØ li·ªáu v√† th·ª±c thi h√†nh ƒë·ªông theo th·ªùi gian th·ª±c. C√°c ti·ªán √≠ch m·ªü r·ªông cung c·∫•p c√°c ƒë·∫£m b·∫£o v·ªÅ b·∫£o m·∫≠t, quy·ªÅn ri√™ng t∆∞ d·ªØ li·ªáu v√† hi·ªáu su·∫•t c·∫•p doanh nghi·ªáp. Ch√∫ng c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng cho c√°c t√°c v·ª• nh∆∞ t·∫°o v√† ch·∫°y m√£, truy v·∫•n c√°c trang web v√† ph√¢n t√≠ch th√¥ng tin t·ª´ c√°c kho d·ªØ li·ªáu ri√™ng t∆∞. Google cung c·∫•p c√°c ti·ªán √≠ch m·ªü r·ªông ƒë∆∞·ª£c x√¢y d·ª±ng s·∫µn cho c√°c tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng ph·ªï bi·∫øn nh∆∞ Code Interpreter (Tr√¨nh th√¥ng d·ªãch m√£) v√† Vertex AI Search, v·ªõi t√πy ch·ªçn t·∫°o c√°c ti·ªán √≠ch m·ªü r·ªông t√πy ch·ªânh. L·ª£i √≠ch ch√≠nh c·ªßa c√°c ti·ªán √≠ch m·ªü r·ªông bao g·ªìm c√°c ki·ªÉm so√°t doanh nghi·ªáp m·∫°nh m·∫Ω v√† t√≠ch h·ª£p li·ªÅn m·∫°ch v·ªõi c√°c s·∫£n ph·∫©m kh√°c c·ªßa Google. S·ª± kh√°c bi·ªát ch√≠nh gi·ªØa ti·ªán √≠ch m·ªü r·ªông v√† g·ªçi h√†m n·∫±m ·ªü vi·ªác th·ª±c thi ch√∫ng: Vertex AI t·ª± ƒë·ªông th·ª±c thi c√°c ti·ªán √≠ch m·ªü r·ªông, trong khi c√°c l·ªánh g·ªçi h√†m y√™u c·∫ßu ng∆∞·ªùi d√πng ho·∫∑c m√°y kh√°ch (client) th·ª±c thi th·ªß c√¥ng.

T√≥m t·∫Øt nhanh

V·∫•n ƒë·ªÅ l√† g√¨:

C√°c LLM l√† nh·ªØng c·ªó m√°y t·∫°o vƒÉn b·∫£n m·∫°nh m·∫Ω, nh∆∞ng v·ªÅ c∆° b·∫£n ch√∫ng b·ªã ng·∫Øt k·∫øt n·ªëi v·ªõi th·∫ø gi·ªõi b√™n ngo√†i. Ki·∫øn th·ª©c c·ªßa ch√∫ng l√† tƒ©nh, b·ªã gi·ªõi h·∫°n trong d·ªØ li·ªáu m√† ch√∫ng ƒë∆∞·ª£c hu·∫•n luy·ªán, v√† ch√∫ng thi·∫øu kh·∫£ nƒÉng th·ª±c hi·ªán c√°c h√†nh ƒë·ªông ho·∫∑c truy xu·∫•t th√¥ng tin th·ªùi gian th·ª±c. H·∫°n ch·∫ø c·ªë h·ªØu n√†y ngƒÉn c·∫£n ch√∫ng ho√†n th√†nh c√°c t√°c v·ª• ƒë√≤i h·ªèi t∆∞∆°ng t√°c v·ªõi c√°c API, c∆° s·ªü d·ªØ li·ªáu ho·∫∑c d·ªãch v·ª• b√™n ngo√†i. N·∫øu kh√¥ng c√≥ c·∫ßu n·ªëi ƒë·∫øn c√°c h·ªá th·ªëng b√™n ngo√†i n√†y, ti·ªán √≠ch c·ªßa ch√∫ng ƒë·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ trong th·∫ø gi·ªõi th·ª±c b·ªã h·∫°n ch·∫ø nghi√™m tr·ªçng.

T·∫°i sao (c·∫ßn gi·∫£i ph√°p):

M·∫´u h√¨nh S·ª≠ d·ª•ng C√¥ng c·ª•, th∆∞·ªùng ƒë∆∞·ª£c tri·ªÉn khai th√¥ng qua g·ªçi h√†m, cung c·∫•p m·ªôt gi·∫£i ph√°p ti√™u chu·∫©n h√≥a cho v·∫•n ƒë·ªÅ n√†y. N√≥ ho·∫°t ƒë·ªông b·∫±ng c√°ch m√¥ t·∫£ c√°c h√†m b√™n ngo√†i c√≥ s·∫µn, ho·∫∑c "c√¥ng c·ª•", cho LLM theo c√°ch m√† n√≥ c√≥ th·ªÉ hi·ªÉu ƒë∆∞·ª£c. D·ª±a tr√™n y√™u c·∫ßu c·ªßa ng∆∞·ªùi d√πng, LLM c·ªßa agent sau ƒë√≥ c√≥ th·ªÉ quy·∫øt ƒë·ªãnh xem c√≥ c·∫ßn m·ªôt c√¥ng c·ª• hay kh√¥ng v√† t·∫°o ra m·ªôt ƒë·ªëi t∆∞·ª£ng d·ªØ li·ªáu c√≥ c·∫•u tr√∫c (nh∆∞ JSON) ch·ªâ ƒë·ªãnh h√†m n√†o c·∫ßn g·ªçi v√† v·ªõi c√°c ƒë·ªëi s·ªë n√†o. M·ªôt l·ªõp ƒëi·ªÅu ph·ªëi s·∫Ω th·ª±c thi l·ªánh g·ªçi h√†m n√†y, truy xu·∫•t k·∫øt qu·∫£ v√† cung c·∫•p l·∫°i cho LLM. ƒêi·ªÅu n√†y cho ph√©p LLM k·∫øt h·ª£p th√¥ng tin b√™n ngo√†i, c·∫≠p nh·∫≠t ho·∫∑c k·∫øt qu·∫£ c·ªßa m·ªôt h√†nh ƒë·ªông v√†o ph·∫£n h·ªìi cu·ªëi c√πng c·ªßa n√≥, gi√∫p n√≥ c√≥ kh·∫£ nƒÉng h√†nh ƒë·ªông m·ªôt c√°ch hi·ªáu qu·∫£.

Nguy√™n t·∫Øc chung:

S·ª≠ d·ª•ng m·∫´u h√¨nh S·ª≠ d·ª•ng C√¥ng c·ª• b·∫•t c·ª© khi n√†o m·ªôt agent c·∫ßn tho√°t ra kh·ªèi ki·∫øn th·ª©c n·ªôi t·∫°i c·ªßa LLM v√† t∆∞∆°ng t√°c v·ªõi th·∫ø gi·ªõi b√™n ngo√†i. ƒêi·ªÅu n√†y l√† c·∫ßn thi·∫øt cho c√°c t√°c v·ª• ƒë√≤i h·ªèi d·ªØ li·ªáu th·ªùi gian th·ª±c (v√≠ d·ª•: ki·ªÉm tra th·ªùi ti·∫øt, gi√° c·ªï phi·∫øu), truy c·∫≠p th√¥ng tin c√° nh√¢n ho·∫∑c ƒë·ªôc quy·ªÅn (v√≠ d·ª•: truy v·∫•n c∆° s·ªü d·ªØ li·ªáu c·ªßa c√¥ng ty), th·ª±c hi·ªán c√°c ph√©p t√≠nh ch√≠nh x√°c, th·ª±c thi m√£, ho·∫∑c k√≠ch ho·∫°t c√°c h√†nh ƒë·ªông trong c√°c h·ªá th·ªëng kh√°c (v√≠ d·ª•: g·ª≠i email, ƒëi·ªÅu khi·ªÉn thi·∫øt b·ªã th√¥ng minh). 

T√≥m t·∫Øt tr·ª±c quan:

<figure> <img src="../imgs/fig.5.2.Tool_use_design_pattern.png" alt="fig.5.2.Tool_use_design_pattern"> <figcaption>H√¨nh 2: M·∫´u h√¨nh thi·∫øt k·∫ø s·ª≠ d·ª•ng c√¥ng c·ª•</figcaption> </figure>

Nh·ªØng ƒëi·ªÉm ch√≠nh c·∫ßn ghi nh·ªõ

S·ª≠ d·ª•ng C√¥ng c·ª• (G·ªçi h√†m) cho ph√©p c√°c agent t∆∞∆°ng t√°c v·ªõi c√°c h·ªá th·ªëng b√™n ngo√†i v√† truy c·∫≠p th√¥ng tin ƒë·ªông.

N√≥ li√™n quan ƒë·∫øn vi·ªác ƒë·ªãnh nghƒ©a c√°c c√¥ng c·ª• v·ªõi c√°c m√¥ t·∫£ v√† tham s·ªë r√µ r√†ng m√† LLM c√≥ th·ªÉ hi·ªÉu ƒë∆∞·ª£c.

LLM quy·∫øt ƒë·ªãnh khi n√†o s·ª≠ d·ª•ng m·ªôt c√¥ng c·ª• v√† t·∫°o ra c√°c l·ªánh g·ªçi h√†m c√≥ c·∫•u tr√∫c.

C√°c framework c·ªßa agent th·ª±c thi c√°c l·ªánh g·ªçi c√¥ng c·ª• th·ª±c t·∫ø v√† tr·∫£ k·∫øt qu·∫£ v·ªÅ cho LLM.

S·ª≠ d·ª•ng C√¥ng c·ª• l√† ƒëi·ªÅu c·∫ßn thi·∫øt ƒë·ªÉ x√¢y d·ª±ng c√°c agent c√≥ th·ªÉ th·ª±c hi·ªán c√°c h√†nh ƒë·ªông trong th·∫ø gi·ªõi th·ª±c v√† cung c·∫•p th√¥ng tin c·∫≠p nh·∫≠t.

LangChain ƒë∆°n gi·∫£n h√≥a vi·ªác ƒë·ªãnh nghƒ©a c√¥ng c·ª• b·∫±ng c√°ch s·ª≠ d·ª•ng decorator "
@tool
" v√† cung c·∫•p "
create_tool_calling_agent
" c≈©ng nh∆∞ "
AgentExecutor
" ƒë·ªÉ x√¢y d·ª±ng c√°c agent s·ª≠ d·ª•ng c√¥ng c·ª•.

Google ADK c√≥ m·ªôt s·ªë c√¥ng c·ª• ƒë∆∞·ª£c x√¢y d·ª±ng s·∫µn r·∫•t h·ªØu √≠ch nh∆∞ Google Search, Code Execution (Th·ª±c thi m√£) v√† Vertex AI Search Tool.

K·∫øt lu·∫≠n

M·∫´u h√¨nh S·ª≠ d·ª•ng C√¥ng c·ª• l√† m·ªôt nguy√™n t·∫Øc ki·∫øn tr√∫c quan tr·ªçng ƒë·ªÉ m·ªü r·ªông ph·∫°m vi ch·ª©c nƒÉng c·ªßa c√°c m√¥ h√¨nh ng√¥n ng·ªØ l·ªõn v∆∞·ª£t ra ngo√†i kh·∫£ nƒÉng t·∫°o vƒÉn b·∫£n n·ªôi t·∫°i c·ªßa ch√∫ng. B·∫±ng c√°ch trang b·ªã cho m√¥ h√¨nh kh·∫£ nƒÉng giao ti·∫øp v·ªõi ph·∫ßn m·ªÅm v√† c√°c ngu·ªìn d·ªØ li·ªáu b√™n ngo√†i, m√¥ h√¨nh n√†y cho ph√©p m·ªôt agent th·ª±c hi·ªán c√°c h√†nh ƒë·ªông, th·ª±c thi c√°c ph√©p t√≠nh v√† truy xu·∫•t th√¥ng tin t·ª´ c√°c h·ªá th·ªëng kh√°c. Qu√° tr√¨nh n√†y li√™n quan ƒë·∫øn vi·ªác m√¥ h√¨nh t·∫°o ra m·ªôt y√™u c·∫ßu c√≥ c·∫•u tr√∫c ƒë·ªÉ g·ªçi m·ªôt c√¥ng c·ª• b√™n ngo√†i khi n√≥ x√°c ƒë·ªãnh r·∫±ng l√†m nh∆∞ v·∫≠y l√† c·∫ßn thi·∫øt ƒë·ªÉ ho√†n th√†nh truy v·∫•n c·ªßa ng∆∞·ªùi d√πng. C√°c framework nh∆∞ LangChain, Google ADK v√† Crew AI cung c·∫•p c√°c th√†nh ph·∫ßn v√† s·ª± tr·ª´u t∆∞·ª£ng h√≥a c√≥ c·∫•u tr√∫c (structured abstractions) t·∫°o ƒëi·ªÅu ki·ªán thu·∫≠n l·ª£i cho vi·ªác t√≠ch h·ª£p c√°c c√¥ng c·ª• b√™n ngo√†i n√†y. C√°c framework n√†y qu·∫£n l√Ω qu√° tr√¨nh hi·ªÉn th·ªã c√°c th√¥ng s·ªë k·ªπ thu·∫≠t c·ªßa c√¥ng c·ª• cho m√¥ h√¨nh v√† ph√¢n t√≠ch c√∫ ph√°p c√°c y√™u c·∫ßu s·ª≠ d·ª•ng c√¥ng c·ª• ti·∫øp theo c·ªßa n√≥. ƒêi·ªÅu n√†y ƒë∆°n gi·∫£n h√≥a vi·ªác ph√°t tri·ªÉn c√°c h·ªá th·ªëng agent ph·ª©c t·∫°p c√≥ th·ªÉ t∆∞∆°ng t√°c v√† th·ª±c hi·ªán h√†nh ƒë·ªông trong c√°c m√¥i tr∆∞·ªùng k·ªπ thu·∫≠t s·ªë b√™n ngo√†i.

T√†i li·ªáu tham kh·∫£o

T√†i li·ªáu LangChain (C√¥ng c·ª•): 
https://python.langchain.com/docs/integrations/tools/

T√†i li·ªáu Google Agent Developer Kit (ADK) (C√¥ng c·ª•): 
https://google.github.io/adk-docs/tools/

T√†i li·ªáu G·ªçi h√†m c·ªßa OpenAI: 
https://platform.openai.com/docs/guides/function-calling

T√†i li·ªáu CrewAI (C√¥ng c·ª•): 
https://docs.crewai.com/concepts/tools

```